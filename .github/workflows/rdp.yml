name: Network Tunnel Workflow

on: workflow_dispatch

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Set up SSH Server
      run: |
        sudo apt-get update
        sudo apt-get install -y openssh-server
        # The 'runner' user already exists, so we just set its password.
        sudo bash -c 'echo "runner:runnerpassword" | chpasswd' # Change this password!
        sudo sed -i 's/#PasswordAuthentication yes/PasswordAuthentication yes/' /etc/ssh/sshd_config
        sudo sed -i 's/PasswordAuthentication no/#PasswordAuthentication no/' /etc/ssh/sshd_config
        sudo service ssh start
        echo "SSH Server is running for the existing 'runner' user."

    - name: Expose SSH Port using bore.pub
      run: |
        curl -LSs https://github.com/ekzhang/bore/releases/download/v0.5.0/bore-v0.5.0-x86_64-unknown-linux-musl.tar.gz | tar zx -C /tmp
        echo "Bore installed. Starting tunnel..."
        echo "Connect to the port shown below from your local machine."
        /tmp/bore local 22 --to bore.pub

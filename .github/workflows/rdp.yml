name: Network Tunnel Workflow

on: workflow_dispatch # Allows you to trigger it manually

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Set up SSH Server
      run: |
        sudo apt-get update
        sudo apt-get install -y openssh-server
        sudo useradd -m runner
        sudo bash -c 'echo "runner:runnerpassword" | chpasswd' # Change this password!
        sudo sed -i 's/#PasswordAuthentication yes/PasswordAuthentication yes/' /etc/ssh/sshd_config
        sudo sed -i 's/PasswordAuthentication no/#PasswordAuthentication no/' /etc/ssh/sshd_config
        sudo service ssh start
        echo "SSH Server is running."

    - name: Expose SSH Port using bore.pub
      run: |
        curl -LSs https://github.com/ekzhang/bore/releases/download/v0.5.0/bore-v0.5.0-x86_64-unknown-linux-musl.tar.gz | tar zx -C /tmp
        echo "Bore installed. Starting tunnel..."
        echo "Connect to the port shown below from your local machine."
        /tmp/bore local 22 --to bore.pub
        
    # You can add your RDP setup step here if you still want it.
    # It will run in the background while the bore tunnel is active.
    # - name: Setup RDP
    #   ... your RDP steps ...
